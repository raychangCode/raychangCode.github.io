<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <title>This is my example homepage.</title>
</head>

<body>
    <h1>IS445 - data viz</h1>
    <h2>Viz for Final</h2>
    <div id='final_viz'></div>

</body>

<script>
finalSpec={
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {"url": "https://data.nasa.gov/resource/gh4g-9sfh.json"},
  "transform": [{"window": [{"op": "row_number", "as": "row_number"}]}],
  "vconcat": [
    {
      "width": 900,
      "transform": [
        {"filter": "datum.mass <= 1000000"},
        {"filter": "datum.year != null"},
        {"filter": {"field": "year", "timeUnit": "year", "gt": 100}}
      ],
      "params": [{"name": "brush", "select": "interval", "value": {"x": [-662623231333,993484218359], "y": [0, 1000]}}],
      "mark": "point",
      "encoding": {
        "x": {"field": "year", "timeUnit": "year", "type": "temporal", "title": "Year"},
        "y": {"field": "mass", "type": "quantitative", "title": "Mass (g)"},
        "color": {
          "condition": {
            "param": "brush",
            "field": "mass",
            "type": "quantitative",
            "scale": {"scheme": "lightmulti"}
          },
          "value": "grey"
        }
      }
    },
    {
      "transform": [{"filter": {"param": "brush"}}],
      "width": 900,
      "mark": "bar",
      "encoding": {
        "x": {"bin": {"maxbins": 50}, "field": "mass"},
        "y": {"aggregate": "count"}
      }
    },
    {
      "projection": {"type": "equalEarth"},
      "width": 900,
      "height": 600,
      "layer": [
        {
          "data": {
            "url": "https://unpkg.com/world-atlas@1/world/110m.json",
            "format": {"type": "topojson", "feature": "countries"}
          },
          "mark": {"type": "geoshape", "fill": "grey", "stroke": "white"}
        },
        {
          "transform": [
            {"filter": {"param": "brush"}},
            {"filter": {"field": "reclong", "valid": true}},
            {"filter": {"field": "reclat", "valid": true}}
          ],
          "mark": "circle",
          "encoding": {
            "longitude": {"field": "reclong", "type": "quantitative"},
            "latitude": {"field": "reclat", "type": "quantitative"},
            "tooltip": [{"field": "name", "type": "ordinal"}, {"field": "year", "timeUnit": "year", "type": "temporal", "title":"Year"}, {"field": "mass", "type": "quantitative", "title":"Mass(g)"} ],
            "size": {
              "field": "mass",
              "type": "quantitative",
              "scale": {"rangeMax": 1000},
              "legend": null
            }
          }
        }
      ]
    },
    {
      "transform": [
        {"filter": {"param": "brush"}},
        {"window": [{"op": "rank", "as": "rank"}]},
        {"filter": {"field": "rank", "lt": 20}}
      ],
      "hconcat": [
        {
          "width": 300,
          "title": "Name",
          "mark": "text",
          "encoding": {
            "text": {"field": "name", "type": "nominal"},
            "y": {"field": "row_number", "type": "ordinal", "axis": null}
          }
        },
        {
          "width": 300,
          "title": "Mass",
          "mark": "text",
          "encoding": {
            "text": {"field": "mass", "type": "nominal"},
            "y": {"field": "row_number", "type": "ordinal", "axis": null}
          }
        },
        {
          "width": 300,
          "title": "class",
          "mark": "text",
          "encoding": {
            "text": {"field": "recclass", "type": "nominal"},
            "y": {"field": "row_number", "type": "ordinal", "axis": null}
          }
        }
      ]
    }
  ],
  "resolve": {"legend": {"color": "independent"}}
};
    vegaEmbed('#final_viz', finalSpec);
</script>

</html>